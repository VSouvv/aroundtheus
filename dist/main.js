!function(){"use strict";class e{constructor(e,t,s,r,i){this._data={name:e.name,link:e.link,id:e._id,isLiked:e.isLiked},this._handleImageClick=s,this._handleDeleteClick=r,this._handleLikeClick=i,this._cardSelector=t}_setEventListeners(){this._likeIcon.addEventListener("click",(()=>{this._handleLikeClick(this._likeIcon,this._data.isLiked,this._data.id),this._data.isLiked=!this._data.isLiked})),this._deleteBtn.addEventListener("click",(()=>{this._handleDeleteClick(this._data.id,this._cardElement)})),this._cardImageEl.addEventListener("click",(()=>{this._handleImageClick(this._data)}))}getView(){return this._cardElement=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0),this._cardImageEl=this._cardElement.querySelector(".card__image"),this._cardTitleEl=this._cardElement.querySelector(".card__title"),this._cardTitleEl.textContent=this._data.name,this._cardImageEl.src=this._data.link,this._cardImageEl.alt="Photo of "+this._data.name,this._likeIcon=this._cardElement.querySelector(".card__react-button"),this._deleteBtn=this._cardElement.querySelector(".card__delete-button"),this._data.isLiked?this._likeIcon.classList.add("card__react-button_active"):this._likeIcon.classList.remove("card__react-button_active"),this._setEventListeners(),this._cardElement}}class t{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}_showInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_checkInputValidity(e){if(!e.validity.valid)return this._showInputError(e);this._hideInputError(e)}_hasInvalidInput(e){return!e.every((e=>e.validity.valid))}_enableButton(){this._submitBtn.classList.remove(this._inactiveButtonClass),this._submitBtn.disabled=!1}disableButton(){this._submitBtn.classList.add(this._inactiveButtonClass),this._submitBtn.disabled=!0}_toggleButtonState(){this._hasInvalidInput(this._inputEls)?this.disableButton():this._enableButton()}resetValidation(){this._inputEls.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}setEventListeners(){this._inputEls=[...this._form.querySelectorAll(this._inputSelector)],this._submitBtn=this._form.querySelector(this._submitButtonSelector),this._inputEls.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault(e)})),this.setEventListeners()}}class s{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{const t=this._renderer(e);this.addItem(t)}))}addItem(e){this._container.prepend(e)}}class r{constructor(e){this._popupElement=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this),this._closeButton=this._popupElement.querySelector(".modal__close-button")}open(){this._popupElement.classList.add("modal_open"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_open"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._closeButton.addEventListener("click",(()=>{this.close()})),this._popupElement.addEventListener("click",(e=>{e.target===this._popupElement&&this.close()}))}}class i extends r{constructor(e,t){super(e),this._popupForm=this._popupElement.querySelector(".modal__form"),this._handleFormSubmit=t,this._inputList=this._popupForm.querySelectorAll(".modal__form-input"),this._submitBtn=this._popupForm.querySelector(".modal__save-button")}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}reset(){this._popupForm&&this._popupForm.reset()}setEventListeners(){super.setEventListeners(),this._popupForm&&this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}open(){super.open()}setSubmitHandler(e){this._handleFormSubmit=e}setLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save";this._submitBtn&&(e?(this._submitBtn.textContent=t,this._submitBtn.setAttribute("disabled",!0)):(this._submitBtn.textContent=s,this._submitBtn.removeAttribute("disabled")))}}const o={formSelector:".modal__form",inputSelector:".modal__form-input",submitButtonSelector:".modal__save-button",inactiveButtonClass:"modal__save-button-disabled",inputErrorClass:"modal__form_input_type_error",errorClass:"modal__form-input-error-visible"},n={profileEditBtn:document.querySelector("#profile-edit-btn"),profileTitleInput:document.querySelector("#profile-title-input"),profileEditForm:document.forms["profile-form"],profileDescriptionInput:document.querySelector("#profile-description-input"),placesAddBtn:document.querySelector("#places-add-btn"),placeAddForm:document.forms["add-place-form"],avatarUpdateBtn:document.querySelector("#avatar-save-btn"),avatarForm:document.forms["update-avatar-form"]},{profileEditBtn:a,profileTitleInput:l,profileEditForm:c,profileDescriptionInput:d,placesAddBtn:h,placeAddForm:u,avatarUpdateBtn:_,avatarForm:m}=n,p=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{method:"GET",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editUserInfo(e,t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addNewPlace(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removePlace(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addLikeReact(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeLikeReact(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"ca917973-003f-412f-833a-d01c5747f711","content-type":"application/json"}});function v(e){S.open(e)}const E=new t(o,c),f=new t(o,u),b=new t(o,m),L=new i("#profile-edit-modal",(function(e){L.setLoading(!0);const t={name:e.title,about:e.description};p.editUserInfo(t.name,t.about).then((e=>{w.setUserInfo(e),L.close()})).catch((e=>{console.error("Error updating user info:",e)})).finally((()=>{L.setLoading(!1)}))})),g=new i("#places-add-modal",(function(e){g.setLoading(!0);const t={name:e.title,link:e.url};p.addNewPlace(t.name,t.link).then((e=>{const t=C({name:e.name,link:e.link,_id:e._id});B.addItem(t),g.close(),g.reset()})).catch((e=>{console.error("Error adding new place:",e)})).finally((()=>{g.setLoading(!1),f.disableButton()}))})),k=new i("#avatar-update-modal",(function(e){let{url:t}=e;k.setLoading(!0),p.updateAvatar(t).then((e=>{w.updateAvatar(t),k.reset(),k.close(),console.log("Success:",e)})).catch((e=>{console.error("Error updating profile avatar:",e)})).finally((()=>{k.setLoading(!0,"Save")}))})),S=new class extends r{constructor(e){super(e),this._previewImage=this._popupElement.querySelector(".modal__image-preview"),this._previewTitle=this._popupElement.querySelector(".modal__image-caption")}open(e){this._previewImage.src=e.link,this._previewImage.alt=e.name,this._previewTitle.textContent=e.name,super.open()}}("#places-preview-modal"),I=new i("#places-delete-modal",(()=>{}));function y(e,t){I.setSubmitHandler((()=>{I.setLoading(!0,"Removing...","Yes"),p.removePlace(e).then((()=>{t.remove(),I.close()})).catch((e=>{console.error("Error deleting place:",e)})).finally((()=>{I.setLoading(!1,"Removing...","Yes")}))})),I.open()}function C(t){return new e(t,"#card-template",v,y,q).getView()}let B;L.setEventListeners(),S.setEventListeners(),k.setEventListeners(),g.setEventListeners(),I.setEventListeners(),b.enableValidation(),E.enableValidation(),f.enableValidation(),p.getInitialCards().then((e=>{B=new s({items:e,renderer:e=>C(e)},".cards__list"),B.renderItems()})).catch((e=>console.error(e)));const w=new class{constructor(){this._profileName=document.querySelector(".profile__title"),this._profileJob=document.querySelector(".profile__description"),this._profileAvatar=document.querySelector(".profile__image")}updateAvatar(e){this._profileAvatar.src=e}getUserInfo(){return{name:this._profileName.textContent,job:this._profileJob.textContent,avatar:this._profileAvatar.src}}setUserInfo(e){let{name:t,about:s,avatar:r}=e;this._profileName.textContent=t,this._profileJob.textContent=s,r?(this._profileAvatar.src=r,this._profileAvatar.alt=t):this._profileAvatar.src="./images/avatar_default.png"}};function q(e,t,s){t?p.removeLikeReact(s).then((()=>{e.classList.remove("card__react-button_active")})).catch((e=>console.error("Error removing like reaction:",e))):p.addLikeReact(s).then((()=>{e.classList.add("card__react-button_active")})).catch((e=>console.error("Error adding like reaction:",e)))}p.getUserInfo().then((e=>{w.setUserInfo(e)})).catch((e=>console.error(e))),a.addEventListener("click",(()=>{const{name:e,job:t}=w.getUserInfo();l.value=e,d.value=t,L.open(),E.resetValidation()})),h.addEventListener("click",(()=>{g.open()})),_.addEventListener("click",(()=>{k.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUE0QixJQUV4RDJJLE9BQU9HLEdBQVVELFFBQVFDLE1BQU0sZ0NBQWlDQSxLQUVuRTlDLEVBQ0cwQixhQUFhQyxHQUNibkIsTUFBSyxLQUNKMkQsRUFBVXJLLFVBQVVDLElBQUksNEJBQTRCLElBRXJENEksT0FBT0csR0FBVUQsUUFBUUMsTUFBTSw4QkFBK0JBLElBRXJFLENBaEdBOUMsRUFDR2UsY0FDQVAsTUFBTTZELElBQ0w1QixFQUFTQyxZQUFZMkIsRUFBWSxJQUVsQzFCLE9BQU9DLEdBQVFDLFFBQVFDLE1BQU1GLEtBOEZoQ3JELEVBQWV0RyxpQkFBaUIsU0FBUyxLQUN2QyxNQUFNLEtBQUVYLEVBQUksSUFBRTRMLEdBQVF6QixFQUFTMUIsY0FDL0J2QixFQUFrQmhCLE1BQVFsRyxFQUMxQnFILEVBQXdCbkIsTUFBUTBGLEVBQ2hDL0IsRUFBaUJ6RSxPQUNqQnNFLEVBQXNCaEcsaUJBQWlCLElBSXpDNEQsRUFBYTNHLGlCQUFpQixTQUFTLEtBQ3JDK0osRUFBY3RGLE1BQU0sSUFJdEJvQyxFQUFnQjdHLGlCQUFpQixTQUFTLEtBQ3hDdUssRUFBa0I5RixNQUFNLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGRhdGEsXHJcbiAgICBjYXJkU2VsZWN0b3IsXHJcbiAgICBoYW5kbGVJbWFnZUNsaWNrLFxyXG4gICAgaGFuZGxlRGVsZXRlQ2xpY2ssXHJcbiAgICBoYW5kbGVMaWtlQ2xpY2tcclxuICApIHtcclxuICAgIHRoaXMuX2RhdGEgPSB7XHJcbiAgICAgIG5hbWU6IGRhdGEubmFtZSxcclxuICAgICAgbGluazogZGF0YS5saW5rLFxyXG4gICAgICBpZDogZGF0YS5faWQsXHJcbiAgICAgIGlzTGlrZWQ6IGRhdGEuaXNMaWtlZCxcclxuICAgIH07XHJcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljaztcclxuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrID0gaGFuZGxlRGVsZXRlQ2xpY2s7XHJcbiAgICB0aGlzLl9oYW5kbGVMaWtlQ2xpY2sgPSBoYW5kbGVMaWtlQ2xpY2s7XHJcbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9saWtlSWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVMaWtlQ2xpY2sodGhpcy5fbGlrZUljb24sIHRoaXMuX2RhdGEuaXNMaWtlZCwgdGhpcy5fZGF0YS5pZCk7XHJcbiAgICAgIHRoaXMuX2RhdGEuaXNMaWtlZCA9ICF0aGlzLl9kYXRhLmlzTGlrZWQ7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX2RlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGVDbGljayh0aGlzLl9kYXRhLmlkLCB0aGlzLl9jYXJkRWxlbWVudCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX2NhcmRJbWFnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sodGhpcy5fZGF0YSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldFZpZXcoKSB7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbCA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgICB0aGlzLl9jYXJkVGl0bGVFbCA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XHJcbiAgICB0aGlzLl9jYXJkVGl0bGVFbC50ZXh0Q29udGVudCA9IHRoaXMuX2RhdGEubmFtZTtcclxuICAgIHRoaXMuX2NhcmRJbWFnZUVsLnNyYyA9IHRoaXMuX2RhdGEubGluaztcclxuICAgIHRoaXMuX2NhcmRJbWFnZUVsLmFsdCA9IFwiUGhvdG8gb2YgXCIgKyB0aGlzLl9kYXRhLm5hbWU7XHJcbiAgICB0aGlzLl9saWtlSWNvbiA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fcmVhY3QtYnV0dG9uXCIpO1xyXG4gICAgdGhpcy5fZGVsZXRlQnRuID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xyXG5cclxuICAgIGlmICh0aGlzLl9kYXRhLmlzTGlrZWQpIHtcclxuICAgICAgdGhpcy5fbGlrZUljb24uY2xhc3NMaXN0LmFkZChcImNhcmRfX3JlYWN0LWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9saWtlSWNvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fcmVhY3QtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgcmV0dXJuIHRoaXMuX2NhcmRFbGVtZW50O1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsKSB7XHJcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcclxuICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBzZXR0aW5ncy5lcnJvckNsYXNzO1xyXG4gICAgdGhpcy5fZm9ybSA9IGZvcm1FbDtcclxuICB9XHJcbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWwpIHtcclxuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvck1lc3NhZ2VFbC50ZXh0Q29udGVudCA9IGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgICBlcnJvck1lc3NhZ2VFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xyXG4gIH1cclxuXHJcbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpIHtcclxuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvck1lc3NhZ2VFbC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICBlcnJvck1lc3NhZ2VFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Vycm9yQ2xhc3MpO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsKSB7XHJcbiAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWwpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgfVxyXG5cclxuICBfaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkge1xyXG4gICAgcmV0dXJuICFpbnB1dExpc3QuZXZlcnkoKGlucHV0RWwpID0+IGlucHV0RWwudmFsaWRpdHkudmFsaWQpO1xyXG4gIH1cclxuXHJcbiAgX2VuYWJsZUJ1dHRvbigpIHtcclxuICAgIHRoaXMuX3N1Ym1pdEJ0bi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgdGhpcy5fc3VibWl0QnRuLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBkaXNhYmxlQnV0dG9uKCkge1xyXG4gICAgdGhpcy5fc3VibWl0QnRuLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB0aGlzLl9zdWJtaXRCdG4uZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xyXG4gICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dCh0aGlzLl9pbnB1dEVscykpIHtcclxuICAgICAgdGhpcy5kaXNhYmxlQnV0dG9uKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuX2VuYWJsZUJ1dHRvbigpO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5faW5wdXRFbHMuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5faW5wdXRFbHMgPSBbLi4udGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXTtcclxuICAgIHRoaXMuX3N1Ym1pdEJ0biA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcblxyXG4gICAgdGhpcy5faW5wdXRFbHMuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWwpO1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoZSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7IC8vZGF0YVxyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjsgLy9mdW5jdGlvblxyXG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICByZW5kZXJJdGVtcygpIHtcclxuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG4gICAgICB0aGlzLmFkZEl0ZW0oZWxlbWVudCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgb3BlbigpIHtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlblwiKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuXCIpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZUVzY0Nsb3NlKGUpIHtcclxuICAgIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2Nsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuICAgICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLl9wb3B1cEVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCkge1xyXG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xyXG4gICAgdGhpcy5faW5wdXRMaXN0ID0gdGhpcy5fcG9wdXBGb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2Zvcm0taW5wdXRcIik7XHJcbiAgICB0aGlzLl9zdWJtaXRCdG4gPSB0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idXR0b25cIik7XHJcbiAgfVxyXG5cclxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICB0aGlzLl9mb3JtVmFsdWVzID0ge307XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgdGhpcy5fZm9ybVZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGhpcy5fZm9ybVZhbHVlcztcclxuICB9XHJcblxyXG4gIHJlc2V0KCkge1xyXG4gICAgaWYgKHRoaXMuX3BvcHVwRm9ybSkge1xyXG4gICAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIGlmICh0aGlzLl9wb3B1cEZvcm0pIHtcclxuICAgICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gIH1cclxuXHJcbiAgc2V0U3VibWl0SGFuZGxlcihuZXdTdWJtaXRIYW5kbGVyKSB7XHJcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gbmV3U3VibWl0SGFuZGxlcjtcclxuICB9XHJcblxyXG4gIHNldExvYWRpbmcoaXNMb2FkaW5nLCBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCIsIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIpIHtcclxuICAgIGlmICh0aGlzLl9zdWJtaXRCdG4pIHtcclxuICAgICAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ0bi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLl9zdWJtaXRCdG4udGV4dENvbnRlbnQgPSBkZWZhdWx0VGV4dDtcclxuICAgICAgICB0aGlzLl9zdWJtaXRCdG4ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiLyogLS0tLS0tLS0tLS0tLS0gRm9ybSBWYWxpZGF0aW9uIFNldHRpbmdzICYgVmFyIC0tLS0tLS0tLS0tLS0tLS0gKi9cclxuZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybS1pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc2F2ZS1idXR0b25cIixcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zYXZlLWJ1dHRvbi1kaXNhYmxlZFwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9fZm9ybV9pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZm9ybS1pbnB1dC1lcnJvci12aXNpYmxlXCIsXHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZWxlbWVudHMgPSB7XHJcbiAgcHJvZmlsZUVkaXRCdG46IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LWJ0blwiKSxcclxuICBwcm9maWxlVGl0bGVJbnB1dDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLXRpdGxlLWlucHV0XCIpLFxyXG4gIHByb2ZpbGVFZGl0Rm9ybTogZG9jdW1lbnQuZm9ybXNbXCJwcm9maWxlLWZvcm1cIl0sXHJcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiKSxcclxuICBwbGFjZXNBZGRCdG46IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxhY2VzLWFkZC1idG5cIiksXHJcbiAgcGxhY2VBZGRGb3JtOiBkb2N1bWVudC5mb3Jtc1tcImFkZC1wbGFjZS1mb3JtXCJdLFxyXG4gIGF2YXRhclVwZGF0ZUJ0bjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItc2F2ZS1idG5cIiksXHJcbiAgYXZhdGFyRm9ybTogZG9jdW1lbnQuZm9ybXNbXCJ1cGRhdGUtYXZhdGFyLWZvcm1cIl0sXHJcbn07XHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgeyBzZXR0aW5ncywgZWxlbWVudHMgfSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XHJcblxyXG4vKiAtLS0tLS0tLS0tIFV0aWxzIEVsZW1lbnRzIC0tLS0tLS0tLS0tLSAqL1xyXG5jb25zdCB7XHJcbiAgcHJvZmlsZUVkaXRCdG4sXHJcbiAgcHJvZmlsZVRpdGxlSW5wdXQsXHJcbiAgcHJvZmlsZUVkaXRGb3JtLFxyXG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LFxyXG4gIHBsYWNlc0FkZEJ0bixcclxuICBwbGFjZUFkZEZvcm0sXHJcbiAgYXZhdGFyVXBkYXRlQnRuLFxyXG4gIGF2YXRhckZvcm0sXHJcbn0gPSBlbGVtZW50cztcclxuXHJcbi8qIC0tLS0tLS0tLS0gQVBJIFZhciAtLS0tLS0tLS0tLS0gKi9cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiY2E5MTc5NzMtMDAzZi00MTJmLTgzM2EtZDAxYzU3NDdmNzExXCIsXHJcbiAgICBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuXHJcbi8qIC0tLS0tLS0tLS0gSW1hZ2UgQ2xpY2sgUHJldmlldyBGdW5jdGlvbiAtLS0tLS0tLS0tLS0gKi9cclxuZnVuY3Rpb24gaGFuZGxlSW1hZ2VDbGljayhpbWFnZURhdGEpIHtcclxuICBpbWFnZVByZXZpZXdNb2RhbC5vcGVuKGltYWdlRGF0YSk7XHJcbn1cclxuXHJcbi8qIC0tLS0tLS0tLS0gVmFsaWRhdGlvbiAtLS0tLS0tLS0tLS0gKi9cclxuY29uc3QgcHJvZmlsZUVkaXRWYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIHByb2ZpbGVFZGl0Rm9ybSk7XHJcbmNvbnN0IGFkZFBsYWNlVmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBwbGFjZUFkZEZvcm0pO1xyXG5jb25zdCBhdmF0YXJWYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIGF2YXRhckZvcm0pO1xyXG5cclxuLyogLS0tLS0tLS0tLSBNb2RhbHMgLS0tLS0tLS0tLS0tICovXHJcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBuZXcgUG9wdXBXaXRoRm9ybShcclxuICBcIiNwcm9maWxlLWVkaXQtbW9kYWxcIixcclxuICBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdFxyXG4pO1xyXG5jb25zdCBhZGRQbGFjZU1vZGFsID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIjcGxhY2VzLWFkZC1tb2RhbFwiLFxyXG4gIGhhbmRsZU5ld1BsYWNlU3VibWl0XHJcbik7XHJcbmNvbnN0IHVwZGF0ZUF2YXRhck1vZGFsID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIjYXZhdGFyLXVwZGF0ZS1tb2RhbFwiLFxyXG4gIGhhbmRsZUF2YXRhclN1Ym1pdFxyXG4pO1xyXG5jb25zdCBpbWFnZVByZXZpZXdNb2RhbCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIiNwbGFjZXMtcHJldmlldy1tb2RhbFwiKTtcclxuY29uc3QgZGVsZXRlUGxhY2VNb2RhbCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI3BsYWNlcy1kZWxldGUtbW9kYWxcIiwgKCkgPT4ge30pO1xyXG5cclxuLyogLS0tLS0tLS0tLSBFdmVudCBMaXN0ZW5lcnMgLS0tLS0tLS0tLS0tICovXHJcbmVkaXRQcm9maWxlTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuaW1hZ2VQcmV2aWV3TW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxudXBkYXRlQXZhdGFyTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuYWRkUGxhY2VNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuLyogLS0tLS0tLS0tLSBGb3JtIFZhbGlkYXRpb24gLS0tLS0tLS0tLS0tICovXHJcbmRlbGV0ZVBsYWNlTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuYXZhdGFyVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbnByb2ZpbGVFZGl0VmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbmFkZFBsYWNlVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG4vKiAtLS0tLS0tLS0tIERlbGV0ZSBQbGFjZSBGdW5jdGlvbiAtLS0tLS0tLS0tLS0gKi9cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2xpY2soY2FyZElELCBjYXJkRWxlbWVudCkge1xyXG4gIGRlbGV0ZVBsYWNlTW9kYWwuc2V0U3VibWl0SGFuZGxlcigoKSA9PiB7XHJcbiAgICBkZWxldGVQbGFjZU1vZGFsLnNldExvYWRpbmcodHJ1ZSwgXCJSZW1vdmluZy4uLlwiLCBcIlllc1wiKTtcclxuICAgIGFwaVxyXG4gICAgICAucmVtb3ZlUGxhY2UoY2FyZElEKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgY2FyZEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgZGVsZXRlUGxhY2VNb2RhbC5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBwbGFjZTpcIiwgZXJyKTtcclxuICAgICAgfSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgIGRlbGV0ZVBsYWNlTW9kYWwuc2V0TG9hZGluZyhmYWxzZSwgXCJSZW1vdmluZy4uLlwiLCBcIlllc1wiKTtcclxuICAgICAgfSk7XHJcbiAgfSk7XHJcbiAgZGVsZXRlUGxhY2VNb2RhbC5vcGVuKCk7XHJcbn1cclxuXHJcbi8qIC0tLS0tLS0tLS0gQ3JlYXRlIENhcmRzIC0tLS0tLS0tLS0tLSAqL1xyXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChjYXJkRGF0YSkge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgIGNhcmREYXRhLFxyXG4gICAgXCIjY2FyZC10ZW1wbGF0ZVwiLFxyXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcclxuICAgIGhhbmRsZURlbGV0ZUNsaWNrLFxyXG4gICAgaGFuZGxlTGlrZVJlYWN0XHJcbiAgKTtcclxuICByZXR1cm4gY2FyZC5nZXRWaWV3KCk7XHJcbn1cclxuXHJcbi8qIC0tLS0tLS0tLS0gR2V0IENhcmRzIC0tLS0tLS0tLS0tLSAqL1xyXG5sZXQgc2VjdGlvbjtcclxuYXBpXHJcbiAgLmdldEluaXRpYWxDYXJkcygpXHJcbiAgLnRoZW4oKGl0ZW1zKSA9PiB7XHJcbiAgICBzZWN0aW9uID0gbmV3IFNlY3Rpb24oXHJcbiAgICAgIHtcclxuICAgICAgICBpdGVtczogaXRlbXMsXHJcbiAgICAgICAgcmVuZGVyZXI6IChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChjYXJkRGF0YSk7XHJcbiAgICAgICAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgICAgXCIuY2FyZHNfX2xpc3RcIlxyXG4gICAgKTtcclxuICAgIHNlY3Rpb24ucmVuZGVySXRlbXMoKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xyXG5cclxuLyogLS0tLS0tLS0tLSBHZXQgUHJvZmlsZSAtLS0tLS0tLS0tLS0gKi9cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oKTtcclxuYXBpXHJcbiAgLmdldFVzZXJJbmZvKClcclxuICAudGhlbigocHJvZmlsZURhdGEpID0+IHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHByb2ZpbGVEYXRhKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xyXG5cclxuLyogLS0tLS0tLS0tLSBQYXRjaCBQcm9maWxlIEVkaXQgRnVuY3Rpb24gLS0tLS0tLS0tLS0tICovXHJcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVFZGl0U3VibWl0KHByb2ZpbGVJbnB1dFZhbHVlcykge1xyXG4gIGVkaXRQcm9maWxlTW9kYWwuc2V0TG9hZGluZyh0cnVlKTtcclxuXHJcbiAgY29uc3QgdXNlckRhdGEgPSB7XHJcbiAgICBuYW1lOiBwcm9maWxlSW5wdXRWYWx1ZXMudGl0bGUsXHJcbiAgICBhYm91dDogcHJvZmlsZUlucHV0VmFsdWVzLmRlc2NyaXB0aW9uLFxyXG4gIH07XHJcblxyXG4gIGFwaVxyXG4gICAgLmVkaXRVc2VySW5mbyh1c2VyRGF0YS5uYW1lLCB1c2VyRGF0YS5hYm91dClcclxuICAgIC50aGVuKCh1cGRhdGVkVXNlckRhdGEpID0+IHtcclxuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8odXBkYXRlZFVzZXJEYXRhKTtcclxuICAgICAgZWRpdFByb2ZpbGVNb2RhbC5jbG9zZSgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyB1c2VyIGluZm86XCIsIGVycik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBlZGl0UHJvZmlsZU1vZGFsLnNldExvYWRpbmcoZmFsc2UpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8qIC0tLS0tLS0tLS0gUGF0Y2ggUHJvZmlsZSBBdmF0YXIgRnVuY3Rpb24gLS0tLS0tLS0tLS0tICovXHJcbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdCh7IHVybCB9KSB7XHJcbiAgdXBkYXRlQXZhdGFyTW9kYWwuc2V0TG9hZGluZyh0cnVlKTtcclxuXHJcbiAgYXBpXHJcbiAgICAudXBkYXRlQXZhdGFyKHVybClcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgdXNlckluZm8udXBkYXRlQXZhdGFyKHVybCk7XHJcbiAgICAgIHVwZGF0ZUF2YXRhck1vZGFsLnJlc2V0KCk7XHJcbiAgICAgIHVwZGF0ZUF2YXRhck1vZGFsLmNsb3NlKCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiU3VjY2VzczpcIiwgcmVzKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgcHJvZmlsZSBhdmF0YXI6XCIsIGVycik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICB1cGRhdGVBdmF0YXJNb2RhbC5zZXRMb2FkaW5nKHRydWUsIFwiU2F2ZVwiKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG4vKiAtLS0tLS0tLS0tIFBvc3QgQWRkIFBsYWNlIEZ1bmN0aW9uIC0tLS0tLS0tLS0tLSAqL1xyXG5mdW5jdGlvbiBoYW5kbGVOZXdQbGFjZVN1Ym1pdChwbGFjZUNhcmREYXRhKSB7XHJcbiAgYWRkUGxhY2VNb2RhbC5zZXRMb2FkaW5nKHRydWUpO1xyXG4gIGNvbnN0IGNhcmREYXRhID0ge1xyXG4gICAgbmFtZTogcGxhY2VDYXJkRGF0YS50aXRsZSxcclxuICAgIGxpbms6IHBsYWNlQ2FyZERhdGEudXJsLFxyXG4gIH07XHJcblxyXG4gIGFwaVxyXG4gICAgLmFkZE5ld1BsYWNlKGNhcmREYXRhLm5hbWUsIGNhcmREYXRhLmxpbmspXHJcbiAgICAudGhlbigobmV3UGxhY2VDYXJkKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoe1xyXG4gICAgICAgIG5hbWU6IG5ld1BsYWNlQ2FyZC5uYW1lLFxyXG4gICAgICAgIGxpbms6IG5ld1BsYWNlQ2FyZC5saW5rLFxyXG4gICAgICAgIF9pZDogbmV3UGxhY2VDYXJkLl9pZCxcclxuICAgICAgfSk7XHJcbiAgICAgIHNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbiAgICAgIGFkZFBsYWNlTW9kYWwuY2xvc2UoKTtcclxuICAgICAgYWRkUGxhY2VNb2RhbC5yZXNldCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhZGRpbmcgbmV3IHBsYWNlOlwiLCBlcnIpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgYWRkUGxhY2VNb2RhbC5zZXRMb2FkaW5nKGZhbHNlKTtcclxuICAgICAgYWRkUGxhY2VWYWxpZGF0aW9uLmRpc2FibGVCdXR0b24oKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG4vKiAtLS0tLS0tLS0tIFB1dCBBZGQgTGlrZSBSZWFjdCAtLS0tLS0tLS0tLS0gKi9cclxuZnVuY3Rpb24gaGFuZGxlTGlrZVJlYWN0KGxpa2VSZWFjdCwgbGlrZVN0YXR1cywgY2FyZElkKSB7XHJcbiAgaWYgKGxpa2VTdGF0dXMpIHtcclxuICAgIGFwaVxyXG4gICAgICAucmVtb3ZlTGlrZVJlYWN0KGNhcmRJZClcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGxpa2VSZWFjdC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fcmVhY3QtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnJvcikgPT4gY29uc29sZS5lcnJvcihcIkVycm9yIHJlbW92aW5nIGxpa2UgcmVhY3Rpb246XCIsIGVycm9yKSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGFwaVxyXG4gICAgICAuYWRkTGlrZVJlYWN0KGNhcmRJZClcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGxpa2VSZWFjdC5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fcmVhY3QtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnJvcikgPT4gY29uc29sZS5lcnJvcihcIkVycm9yIGFkZGluZyBsaWtlIHJlYWN0aW9uOlwiLCBlcnJvcikpO1xyXG4gIH1cclxufVxyXG5cclxuLyogLS0tLS0tLS0tLSBFZGl0IFByb2ZpbGUgQnV0dG9uIExpc3RlbmVyIC0tLS0tLS0tLS0tLSAqL1xyXG5wcm9maWxlRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNvbnN0IHsgbmFtZSwgam9iIH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xyXG4gIHByb2ZpbGVUaXRsZUlucHV0LnZhbHVlID0gbmFtZTtcclxuICBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IGpvYjtcclxuICBlZGl0UHJvZmlsZU1vZGFsLm9wZW4oKTtcclxuICBwcm9maWxlRWRpdFZhbGlkYXRpb24ucmVzZXRWYWxpZGF0aW9uKCk7XHJcbn0pO1xyXG5cclxuLyogLS0tLS0tLS0tLSBBZGQgUGxhY2UgQnV0dG9uIExpc3RlbmVyIC0tLS0tLS0tLS0tLSAqL1xyXG5wbGFjZXNBZGRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhZGRQbGFjZU1vZGFsLm9wZW4oKTtcclxufSk7XHJcblxyXG4vKiAtLS0tLS0tLS0tIFByb2ZpbGUgQXZhdGFyIEJ1dHRvbiBMaXN0ZW5lciAtLS0tLS0tLS0tLS0gKi9cclxuYXZhdGFyVXBkYXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgdXBkYXRlQXZhdGFyTW9kYWwub3BlbigpO1xyXG59KTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xyXG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcclxuICB9XHJcblxyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZWRpdFVzZXJJbmZvKG5hbWUsIGFib3V0KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGFib3V0IH0pLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZE5ld1BsYWNlKG5hbWUsIGxpbmspIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBsaW5rIH0pLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlbW92ZVBsYWNlKGNhcmRJRCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElEfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUF2YXRhcihhdmF0YXIpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhciB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZGRMaWtlUmVhY3QoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlTGlrZVJlYWN0KGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX3ByZXZpZXdJbWFnZSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBcIi5tb2RhbF9faW1hZ2UtcHJldmlld1wiXHJcbiAgICApO1xyXG4gICAgdGhpcy5fcHJldmlld1RpdGxlID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIFwiLm1vZGFsX19pbWFnZS1jYXB0aW9uXCJcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBvcGVuKGltYWdlRGF0YSkge1xyXG4gICAgdGhpcy5fcHJldmlld0ltYWdlLnNyYyA9IGltYWdlRGF0YS5saW5rO1xyXG4gICAgdGhpcy5fcHJldmlld0ltYWdlLmFsdCA9IGltYWdlRGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fcHJldmlld1RpdGxlLnRleHRDb250ZW50ID0gaW1hZ2VEYXRhLm5hbWU7XHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuX3Byb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX190aXRsZVwiKTtcclxuICAgIHRoaXMuX3Byb2ZpbGVKb2IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xyXG4gICAgdGhpcy5fcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2VcIik7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVBdmF0YXIoaW1hZ2UpIHtcclxuICAgIHRoaXMuX3Byb2ZpbGVBdmF0YXIuc3JjID0gaW1hZ2U7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxyXG4gICAgICBqb2I6IHRoaXMuX3Byb2ZpbGVKb2IudGV4dENvbnRlbnQsXHJcbiAgICAgIGF2YXRhcjogdGhpcy5fcHJvZmlsZUF2YXRhci5zcmMsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8oeyBuYW1lLCBhYm91dCwgYXZhdGFyIH0pIHtcclxuICAgIHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgIHRoaXMuX3Byb2ZpbGVKb2IudGV4dENvbnRlbnQgPSBhYm91dDtcclxuICAgIGlmIChhdmF0YXIpIHtcclxuICAgICAgdGhpcy5fcHJvZmlsZUF2YXRhci5zcmMgPSBhdmF0YXI7XHJcbiAgICAgIHRoaXMuX3Byb2ZpbGVBdmF0YXIuYWx0ID0gbmFtZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3Byb2ZpbGVBdmF0YXIuc3JjID0gXCIuL2ltYWdlcy9hdmF0YXJfZGVmYXVsdC5wbmdcIjtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVJbWFnZUNsaWNrIiwiaGFuZGxlRGVsZXRlQ2xpY2siLCJoYW5kbGVMaWtlQ2xpY2siLCJ0aGlzIiwiX2RhdGEiLCJuYW1lIiwibGluayIsImlkIiwiX2lkIiwiaXNMaWtlZCIsIl9oYW5kbGVJbWFnZUNsaWNrIiwiX2hhbmRsZURlbGV0ZUNsaWNrIiwiX2hhbmRsZUxpa2VDbGljayIsIl9jYXJkU2VsZWN0b3IiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJfbGlrZUljb24iLCJhZGRFdmVudExpc3RlbmVyIiwiX2RlbGV0ZUJ0biIsIl9jYXJkRWxlbWVudCIsIl9jYXJkSW1hZ2VFbCIsImdldFZpZXciLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX2NhcmRUaXRsZUVsIiwidGV4dENvbnRlbnQiLCJzcmMiLCJhbHQiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJGb3JtVmFsaWRhdG9yIiwic2V0dGluZ3MiLCJmb3JtRWwiLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uU2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIl9pbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJfZm9ybSIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0RWwiLCJlcnJvck1lc3NhZ2VFbCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGFzSW52YWxpZElucHV0IiwiaW5wdXRMaXN0IiwiZXZlcnkiLCJfZW5hYmxlQnV0dG9uIiwiX3N1Ym1pdEJ0biIsImRpc2FibGVkIiwiZGlzYWJsZUJ1dHRvbiIsIl90b2dnbGVCdXR0b25TdGF0ZSIsIl9pbnB1dEVscyIsInJlc2V0VmFsaWRhdGlvbiIsImZvckVhY2giLCJzZXRFdmVudExpc3RlbmVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlbmFibGVWYWxpZGF0aW9uIiwiZSIsInByZXZlbnREZWZhdWx0IiwiU2VjdGlvbiIsIl9yZWYiLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiZWxlbWVudCIsImFkZEl0ZW0iLCJwcmVwZW5kIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwRWxlbWVudCIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJfY2xvc2VCdXR0b24iLCJvcGVuIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5IiwidGFyZ2V0IiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9wb3B1cEZvcm0iLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9pbnB1dExpc3QiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJfZm9ybVZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJyZXNldCIsInNldFN1Ym1pdEhhbmRsZXIiLCJuZXdTdWJtaXRIYW5kbGVyIiwic2V0TG9hZGluZyIsImlzTG9hZGluZyIsImxvYWRpbmdUZXh0IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiZGVmYXVsdFRleHQiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJmb3JtU2VsZWN0b3IiLCJlbGVtZW50cyIsInByb2ZpbGVFZGl0QnRuIiwicHJvZmlsZVRpdGxlSW5wdXQiLCJwcm9maWxlRWRpdEZvcm0iLCJmb3JtcyIsInByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwicGxhY2VzQWRkQnRuIiwicGxhY2VBZGRGb3JtIiwiYXZhdGFyVXBkYXRlQnRuIiwiYXZhdGFyRm9ybSIsImFwaSIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwibWV0aG9kIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRVc2VySW5mbyIsImVkaXRVc2VySW5mbyIsImFib3V0IiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhZGROZXdQbGFjZSIsInJlbW92ZVBsYWNlIiwiY2FyZElEIiwidXBkYXRlQXZhdGFyIiwiYXZhdGFyIiwiYWRkTGlrZVJlYWN0IiwiY2FyZElkIiwicmVtb3ZlTGlrZVJlYWN0IiwiYXV0aG9yaXphdGlvbiIsImltYWdlRGF0YSIsImltYWdlUHJldmlld01vZGFsIiwicHJvZmlsZUVkaXRWYWxpZGF0aW9uIiwiYWRkUGxhY2VWYWxpZGF0aW9uIiwiYXZhdGFyVmFsaWRhdGlvbiIsImVkaXRQcm9maWxlTW9kYWwiLCJwcm9maWxlSW5wdXRWYWx1ZXMiLCJ1c2VyRGF0YSIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJ1cGRhdGVkVXNlckRhdGEiLCJ1c2VySW5mbyIsInNldFVzZXJJbmZvIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJmaW5hbGx5IiwiYWRkUGxhY2VNb2RhbCIsInBsYWNlQ2FyZERhdGEiLCJjYXJkRGF0YSIsInVybCIsIm5ld1BsYWNlQ2FyZCIsImNhcmRFbGVtZW50IiwiZ2V0Q2FyZEVsZW1lbnQiLCJzZWN0aW9uIiwidXBkYXRlQXZhdGFyTW9kYWwiLCJsb2ciLCJfcHJldmlld0ltYWdlIiwiX3ByZXZpZXdUaXRsZSIsImRlbGV0ZVBsYWNlTW9kYWwiLCJoYW5kbGVMaWtlUmVhY3QiLCJfcHJvZmlsZU5hbWUiLCJfcHJvZmlsZUpvYiIsIl9wcm9maWxlQXZhdGFyIiwiaW1hZ2UiLCJqb2IiLCJsaWtlUmVhY3QiLCJsaWtlU3RhdHVzIiwicHJvZmlsZURhdGEiXSwic291cmNlUm9vdCI6IiJ9